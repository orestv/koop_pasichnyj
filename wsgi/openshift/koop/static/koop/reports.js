// Generated by CoffeeScript 1.4.0
(function() {
  var NODETYPE_FOLDER, NODETYPE_REPORT, document_loaded, enable_tabs, node_selected, setup_tree, update_folder_form, update_report_form;

  NODETYPE_FOLDER = 'folder';

  NODETYPE_REPORT = 'report';

  document_loaded = function() {
    $('#folderFormsContainer').hide();
    $('#reportFormsContainer').hide();
    setup_tree();
    return enable_tabs();
  };

  enable_tabs = function() {
    var _this = this;
    return $('#folderTabList a').click(function(e) {
      e.preventDefault();
      return $(_this).tab('show');
    });
  };

  node_selected = function(e, data) {
    if (data.node.type === NODETYPE_FOLDER) {
      return update_folder_form(data.node);
    } else if (data.node.type === NODETYPE_REPORT) {
      return update_report_form(data.node);
    }
  };

  update_report_form = function(reportNode) {
    $('#folderFormsContainer').hide();
    return $('#reportFormsContainer').show();
  };

  update_folder_form = function(folderNode) {
    $('#reportFormsContainer').hide();
    $('#folderFormsContainer').show();
    $('#folderName').text(folderNode.text);
    return $('#fileUploadForm input[name="folder_id"]').val(folderNode.id);
  };

  setup_tree = function() {
    var treeContainer;
    treeContainer = $('#reportsTree');
    $(treeContainer).jstree({
      core: {
        themes: {
          variant: 'large'
        },
        data: {
          url: '/api/tree'
        },
        multiple: false
      },
      types: {
        folder: {
          icon: 'glyphicon glyphicon-folder-open',
          valid_children: [NODETYPE_FOLDER, NODETYPE_REPORT]
        },
        report: {
          icon: 'glyphicon glyphicon-file',
          valid_children: []
        }
      },
      plugins: ['wholerow', 'state', 'types']
    });
    return $(treeContainer).on('select_node.jstree', node_selected);
  };

  $(document).ready(document_loaded);

}).call(this);
